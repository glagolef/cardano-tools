# cardano-tools

## random-delegator-picker --pool-id

This python program draws a weighted random active delegator or delegators of a particular pool for a giveaway.

The more ada a delegator has, the more chance it has of getting drawn.

The pool's owner and reward accounts are automatically removed from the draw as including them would likely be illegal.

The tool is based off [pooltool.io getSigma.py script](https://github.com/papacarp/pooltool.io/tree/master/leaderLogs)

## random-delegator-picker --policy-id
This feature draws a weighted random token owner of a particular cardano native asset, fungible or non-fungible, with a specified policy id.

The more tokens (of the specified policy id) an address has, the more chance it has of getting drawn.

Nothing spec

## Currently NOT supported:
--policy-id and --pool-id together are not supported, has to be one or the other.
--exclude flag does not yet work with --policy-id

## Dependencies

Requires ```python3```, ledger.json generated by ```cardano-cli``` [go here](https://github.com/glagolef/cardano-tools#pull-down-ledger-state)

random-delegator-picker --policy-id command tries to use IOHK's ```bech32``` binary. 
If it's included in the PATH you don't need to do anything. 
If it is not, you can either add it to the PATH or specify the path to the binary in runbech32.sh file if you want the bech32 version of winner address(es).

## Usage & Examples
### Pull down the latest ledger state first!
This pulls down the latest ledger state and may take a few minutes. No need to run more than once per epoch as _active_ delegators are used.
```bash
cardano-cli query ledger-state --mainnet > ledger.json
```
### Real life active delegators example
This will generate 3 unique winners, excluding 1b9bb7f381fd56c239903b380f44583ce5c43dd51a350497bc0824a4 staking key as well as delegators that have less than 1 ada.
```bash
python3 randomdelegatorpicker.py --ledger ledger.json --pool-id b40683f4baad755ff60f26dc73c3e371ac4c5e422feef2fc1f5f29bf --exclude 1b9bb7f381fd56c239903b380f44583ce5c43dd51a350497bc0824a4 --winners 3 --min-ada 1 --unique
```
If working directory has a ledger.json file already, only --pool-id argument is required. All others are optional but may be useful to specify.

### Real life NFT holders example
This will generate 3 unique winners from a list of token holder addresses that hold at least 3 tokens.
```bash
python3 random.py --ledger ledger.json --policy-id 0e14267a8020229adc0184dd25fa3174c3f7d6caadcb4425c70e7c04 --winners 3 --min-tokens 3 --unique
```
If working directory has a ledger.json file already, only --policy-id argument is required. All others are optional but may be useful to specify.


### Help usage
```bash
python3 randomdelegatorpicker.py --help
python3 randomdelegatorpicker.py -h
usage: randomdelegatorpicker.py [-h] --pool-id ID [--ledger LEDGER] [--exclude EXCLUDE_ADDRESSES] [--winners NUMBER_WINNERS] [--min-ada MIN_ADA] [--unique]

Get random winner(s) for a raffle/giveaway. Example usage 1: 
python3 random.py --ledger ledger.json --pool-id b40683f4baad755ff60f26dc73c3e371ac4c5e422feef2fc1f5f29bf --exclude 002545ccd16d81e202288049d22f0a50c3fbf520cf2a206ccd7765ff --winners 3 --min-tokens 1 --unique
Example usage 2: 
python3 random.py --ledger ledger.json --policy-id 0e14267a8020229adc0184dd25fa3174c3f7d6caadcb4425c70e7c04 --winners 3 --min-tokens 3 --unique


optional arguments:
  --help, -h            show this help message and exit
  --pool-id ID, -i ID   the pool ID
  --policy-id ID, -p POLICY_ID   the token Policy Id
  --ledger LEDGER, -l LEDGER
                        the path to a current ledger-state JSON file
  --exclude EXCLUDE_ADDRESSES, -e EXCLUDE_ADDRESSES
                        if specified will exclude provided address(es) from the raffle. E.g. --exclude
                        "1b9bb7f381fd56c239903b380f44583ce5c43dd51a350497bc0824a4,002545ccd16d81e202288049d22f0a50c3fbf520cf2a206ccd7765ff"
  --winners NUMBER_WINNERS, -w NUMBER_WINNERS
                        if specified will generate specified number of winners
  --min-tokens MIN_TOKENS, -m MIN_TOKENS
                        if specified will ignore addresses containing balances below the provided threshold
  --unique, -u          if used, the winners will be unique (max 1 prize per address). Only makes sense to use if --winners is specified.
```
